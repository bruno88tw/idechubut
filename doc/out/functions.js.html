<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: js/functions.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: js/functions.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/**
 *  @file js/functions.js
 *  @author Bruno José Vecchietti &lt;bruno88tw@gmial.com>
 *  @fileOverview Archivo en el que se definen funciones de variada utilidad.
 *  @copyright Copyright (C) 2012  Bruno José Vecchietti.
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *  &lt;p>
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *  &lt;p>
 *  You should have received a copy of the GNU General Public License
 *  along with this program.  If not, see {@link http://www.gnu.org/licenses/}. 
 */

/**
 * Dada una url de un servidor wms devuelve la url del getCapabilities.
 * @param {String} wms_url URL del servidor wms.
 * @returns {String} URL del protocolo WMS getCapabilities del servidor WMS dado.
 */
function getCapabilitiesUrl(wms_url){

    var cap_url;

    if (wms_url.indexOf("?") == -1){
        cap_url = wms_url + "?service=wms&request=GetCapabilities";
    }else{
        cap_url = wms_url + "&service=wms&request=GetCapabilities";
    }    
    
    return cap_url;
    
};

/**
 * Dado un nombre de capa corrobora si existe o no en el mapa.
 * @param {String} nombre nombre de la capa.
 * @returns {Boolean} verdadero si existe el nombre de capa, falso si no existe.
 */
function existeNombreCapa(nombre){
    
    if (app.map.getLayersByName(nombre)[0] == null){
        return false;
    }else{
        return true;
    }    
    
};

/**
 * Dado un nombre de capa lo numera en caso de que ya exista una capa con el mismo nombre.
 * @param {String} nombre nombre de capa
 * @returns {String} El nombre de la capa numerado.
 */
function numerarNombre(nombre){
    
    var nombrecapa = nombre;
    var i = 1;    
    
    while(existeNombreCapa(nombrecapa)){
        nombrecapa = nombre + i;
        i++;
    }
    
    return nombrecapa;
    
};

/**
 * Da formato a la información obtenida del control mouseposition.
 * @param {type} coordinate
 * @param {type} type
 * @returns {String}
 */
function convertDMS(coordinate, type) {
    var coords;

    abscoordinate = Math.abs(coordinate);
    coordinatedegrees = Math.floor(abscoordinate);

    coordinateminutes = (abscoordinate - coordinatedegrees)/(1/60);
    tempcoordinateminutes = coordinateminutes;
    coordinateminutes = Math.floor(coordinateminutes);
    coordinateseconds = (tempcoordinateminutes - coordinateminutes)/(1/60);
    coordinateseconds =  Math.round(coordinateseconds*10);
    coordinateseconds /= 10;
    coordinateseconds = Math.round(coordinateseconds);

    if( coordinatedegrees &lt; 10 )
      coordinatedegrees = "0" + coordinatedegrees;

    if( coordinateminutes &lt; 10 )
      coordinateminutes = "0" + coordinateminutes;

    if( coordinateseconds &lt; 10 )
      coordinateseconds = "0" + coordinateseconds;

    if(type == "LAT"){
        coords = "&lt;b>lat: &lt;/b>"+coordinatedegrees+"º "+coordinateminutes+"' "+coordinateseconds+"'' "+this.getHemi(coordinate, type)+"&nbsp&nbsp";
    }else{
        coords = "&lt;b>lon: &lt;/b>"+coordinatedegrees+"º "+coordinateminutes+"' "+coordinateseconds+"'' "+this.getHemi(coordinate, type);
    }            

    return coords;
};

/**
 * Devuelve la abreviación de hemisferio para una coordenada dada.
 * @param {type} coordinate
 * @param {type} type
 * @returns {String}
 */
function getHemi(coordinate, type) {
    var coordinatehemi = "";
    if (type == 'LAT') {
      if (coordinate >= 0) {
        coordinatehemi = "N";
      }
      else {
        coordinatehemi = "S";
      }
    }
    else if (type == 'LON') {
      if (coordinate >= 0) {
        coordinatehemi = "E";
      } else {
        coordinatehemi = "O";
      }
    }

    return coordinatehemi;
};

/**
 * Posiciona la escala en el mapa de acuerdo a la configuración de componentes actuales
 * @returns {undefined} Esta función no devuelve resultados.
 */
function acomodarScaleline(){
    
    var legendpanelcss = document.getElementById("legenddiv").style;
    var scalelinecss = document.getElementById("scalelinediv").style;
    var left;
    var bottom;
    if(legendpanelcss.display == "block"){
        left = "270px";                        
    }else{
        left = "10px";       
    }
    
    bottom = "5px";      

    scalelinecss.left = left;
    scalelinecss.bottom = bottom;    
    
}

/**
 * Posiciona el navegador en el mapa de acuerdo a la configuración de componentes actuales.
 * @returns {undefined} Esta función no devuelve resultados.
 */
function acomodarNavegador(){

    var legendpanelcss = document.getElementById("legenddiv").style;
    var existeNavegador = app.map.getControlsByClass('OpenLayers.Control.PanZoomBar')[0];
    var left;
    var top;
    
    if(existeNavegador != null){
        
        if(legendpanelcss.display == "block"){
            left = 134;                        
        }else{
            left = 6;       
        }
        top = 2;                  
        
        app.map.removeControl(app.map.getControlsByClass('OpenLayers.Control.PanZoomBar')[0]);   
        app.map.addControl(new OpenLayers.Control.PanZoomBar(),new OpenLayers.Pixel(left,top));                                             
             
    }
     
    
};

/**
 * Crea el archivo de exportación del árbol de capas.
 * @param {type} father
 * @param {type} children
 * @returns {undefined} Esta función no devuelve resultados.
 */
function saveLayerTree(father, children){
    
    for(var i = 0; i &lt; children.length; i++){
        if(children[i].isLeaf()){
            var layer = app.map.getLayersByName(children[i].attributes.layer)[0];
            father.push({"type":"leaf", "title":children[i].attributes.text, "server":layer.url, "options":layer.options, "params":layer.params});
        }else{
            var grandchildren = [];
            saveLayerTree(grandchildren,children[i].childNodes);
            father.push({"type":"folder","name":children[i].attributes.text,"children":grandchildren});
            
        }
    }    
    
};

/**
 * Crea el archivo de exportación del índice de las capas.
 * @returns {undefined} Esta función no devuelve resultados.
 */
function saveLayerIndex(){
    
    var index = [];
    
    for(var i = 0; i &lt; app.map.layers.length; i++){
        index[i] = app.map.layers[i].name;
    }    
    
    return index;
    
};

/**
 * Restaura el índice de las capas dado un archivo de resguardo.
 * @param {type} index
 * @returns {undefined} Esta función no devuelve resultados.
 */
function restoreIndex(index){
    
    var layer;
    for(var i = 0; i &lt; index.length; i++){
        layer = app.map.getLayersByName(index[i])[0];
        app.map.setLayerIndex(layer,i);
    }      
    
};

/**
 * Dado un archivo de resguardo de árbol de capas, agrega la descendencia a un nodo padre dado
 * @param {type} father
 * @param {type} children
 * @returns {undefined} Esta función no devuelve resultados.
 */
function restoreTree(father,children){
    
    var newNode;
    
    for(var x = 0; x &lt; children.length;x++){
        if(children[x].type == "folder"){
            newNode = createNode(children[x].name);
            father.appendChild(newNode);
            restoreTree(newNode,children[x].children);
        }else{
            newNode = createLeaf(children[x].title,children[x].server,children[x].params,children[x].options);
            father.appendChild(newNode);
        }          
    }
    
};

/**
 * Dado un nodo, expande todos sus nodos hijos.
 * @param {type} node
 * @returns {undefined} Esta función no devuelve resultados.
 */
function expandAll(node){
    if (!node.isLeaf()){
        node.expand();
        node.eachChild(function(childnode){
            expandAll(childnode);
        });
    }
};

/**
 * Dado un nodo, colapsa todos sus nodos hijos.
 * @param {type} node
 * @returns {undefined} Esta función no devuelve resultados.
 */
function collapseAll(node){
    if (!node.isLeaf()){
        node.collapse();
        node.eachChild(function(childnode){
            collapseAll(childnode);
        });
    }    
};

/**
 * Dado un nodo, elimina todos sus nodos hijos y a sí mismo.
 * @param {type} node
 * @returns {undefined} Esta función no devuelve resultados.
 */
function removeLayers(node){
    
    node.eachChild(function(childnode){
        if (childnode.isLeaf()){
            app.map.removeLayer(app.map.getLayersByName(childnode.attributes.layer)[0]);        
        }else{
            removeLayers(childnode);
        } 
    });
    
};

/**
 * Dado un nodo, le asigna un nombre.
 * @param {type} e
 * @returns {undefined} Esta función no devuelve resultados.
 */
function setFolderName(e){       
    
    var folder = e;
    
    Ext.MessageBox.prompt('Nombre de carpeta', '', function(btn, text){
        if (btn == "ok"){
            folder.setText(text);
        }
    });
        
};

/**
 * Crea una instancia de un nodo que no es hoja.
 * @param {type} text
 * @returns {Ext.tree.TreeNode}
 */
function createNode(text){
    
    var node = new Ext.tree.TreeNode({
        text: text,
        expanded: false,
        icon: "img/folder.png",
        leaf: false,
        listeners:{
            contextmenu: function(nodo, event){handler.onNodeContextMenu(nodo, event);}
        }
    });

    return node;
    
};

/**
 * Crea una instancia de un nodo hoja.
 * @param {type} titulo
 * @param {type} servidor
 * @param {type} params
 * @param {type} options
 * @returns {GeoExt.tree.LayerNode}
 */
function createLeaf(titulo, servidor, params, options){    
    
    app.map.addLayer(new OpenLayers.Layer.WMS(
        titulo, 
        servidor, 
        params, 
        options
    ));          
    
    var leaf = new GeoExt.tree.LayerNode({
        text: titulo,
        layer: titulo,   
        icon: "img/layers3.png",
        leaf:true,
        listeners:{
            contextmenu: function(leaf, event){handler.onLeafContextMenu(leaf, event, titulo, params)},
            checkchange: function(leaf){leaf.select();}
        },
        map: app.map
    });
    
    return leaf;
 
};</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Namespaces</h3><ul><li><a href="app.html">app</a></li><li><a href="componentes.html">componentes</a></li><li><a href="config.html">config</a></li><li><a href="handler.html">handler</a></li><li><a href="panel.html">panel</a></li><li><a href="toolbar.html">toolbar</a></li></ul><h3>Global</h3><ul><li><a href="global.html#acomodarNavegador">acomodarNavegador</a></li><li><a href="global.html#acomodarScaleline">acomodarScaleline</a></li><li><a href="global.html#collapseAll">collapseAll</a></li><li><a href="global.html#convertDMS">convertDMS</a></li><li><a href="global.html#createLeaf">createLeaf</a></li><li><a href="global.html#createNode">createNode</a></li><li><a href="global.html#existeNombreCapa">existeNombreCapa</a></li><li><a href="global.html#expandAll">expandAll</a></li><li><a href="global.html#getCapabilitiesUrl">getCapabilitiesUrl</a></li><li><a href="global.html#getHemi">getHemi</a></li><li><a href="global.html#numerarNombre">numerarNombre</a></li><li><a href="global.html#removeLayers">removeLayers</a></li><li><a href="global.html#restoreIndex">restoreIndex</a></li><li><a href="global.html#restoreTree">restoreTree</a></li><li><a href="global.html#saveLayerIndex">saveLayerIndex</a></li><li><a href="global.html#saveLayerTree">saveLayerTree</a></li><li><a href="global.html#setFolderName">setFolderName</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.0-dev</a> on Fri Jul 12 2013 12:50:39 GMT-0300 (ART)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
